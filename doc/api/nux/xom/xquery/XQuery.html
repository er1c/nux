<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.5.0_06) on Sun Jun 18 22:26:33 PDT 2006 -->
<TITLE>
XQuery (Nux 1.6 - API Specification)
</TITLE>

<META NAME="keywords" CONTENT="nux.xom.xquery.XQuery class">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="XQuery (Nux 1.6 - API Specification)";
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/XQuery.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
<b>Nux 1.6</b></EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../nux/xom/xquery/StreamingTransform.html" title="interface in nux.xom.xquery"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?nux/xom/xquery/XQuery.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="XQuery.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
nux.xom.xquery</FONT>
<BR>
Class XQuery</H2>
<PRE>
<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../../resources/inherit.gif" ALT="extended by "><B>nux.xom.xquery.XQuery</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>XQuery</B><DT>extends <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html" title="class or interface in java.lang">Object</A></DL>
</PRE>

<P>
Compiled representation of a W3C XQuery (thread-safe).
 Since XQuery can be seen as a superset of XPath 2.0 this class can also be used with 
 plain XPath expressions as queries.
 <p> 
 Instances are considered immutable and thread-safe; The same compiled query may 
 be executed (evaluated) many times in series or in parallel,
 just like <A HREF="http://www.xom.nu/apidocs/nu/xom/xslt/XSLTransform.html" title="class or interface in nu.xom.xslt"><CODE>XSLTransform</CODE></A> objects.
 A compiled query is conceptually similar to a JDBC <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/sql/PreparedStatement.html" title="class or interface in java.sql"><CODE>PreparedStatement</CODE></A>.
 
 <h4>Example usage</h4>
 
 <pre>
     Document doc = new Builder().build(new File("samples/data/periodic.xml"));
  
     // find the atom named 'Zinc' in the periodic table:
     Node result = XQueryUtil.xquery(doc, "/PERIODIC_TABLE/ATOM[NAME = 'Zinc']").get(0);
     System.out.println("result=" + result.toXML());
 
     // equivalent via the more powerful underlying API:
     XQuery xquery = new XQuery("/PERIODIC_TABLE/ATOM[NAME = 'Zinc']", null);
     Node result = xquery.execute(doc).next();
 
     // count the numer of elements in a document tree:
     int count = XQueryUtil.xquery(doc, "//*").size();
     System.out.println("count=" + count);
 
     // equivalent via the XPath count() function:
     int count = Integer.parseInt(XQueryUtil.xquery(doc, "count(//*)").get(0).getValue());
     System.out.println("count=" + count);
 </pre>
 
 A query to find the links of all images (or all JPG images) in a XHTML-like document:
 <pre>
     Document doc = new Builder().build(new File("/tmp/test.xml"));
     Nodes results = XQueryUtil.xquery(doc, "//*:img/@src");
     // Nodes results = XQueryUtil.xquery(doc, "//*:img/@src[matches(., '.jpg')]");
 
     for (int i=0; i < results.size(); i++) {
         System.out.println("node "+i+": "+results.get(i).toXML());
         //System.out.println("node "+i+": "+ XOMUtil.toPrettyXML(results.get(i)));
     }
 </pre>


 <h4>Namespaces</h4>
 
 A query can use namespaces. 
 Here is an example that lists the titles of Tim Bray's blog articles via the Atom feed:
 <pre>
 declare namespace atom = "http://www.w3.org/2005/Atom"; 
 declare namespace xsd = "http://www.w3.org/2001/XMLSchema";
 doc("http://www.tbray.org/ongoing/ongoing.atom")/atom:feed/atom:entry/atom:title
 </pre>
 
 Namespace declarations can be defined inline within the query prolog via <code>declare namespace</code>, 
 and <code>declare default element namespace</code> directives, as described above. 
 They can also be defined via the <code>declareNamespace()</code> methods and 
 <code>setDefaultElementNamespace()</code> method of a <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/StaticQueryContext.html" title="class or interface in net.sf.saxon.query"><CODE>StaticQueryContext</CODE></A>.
 
 
 <h4>Passing variables to a query</h4>
 
 A query can declare <i>local</i> variables, for example:
 <pre>
     declare variable $i := 7;
     declare variable $j as xs:integer := 7;
     declare variable $math:pi as xs:double := 3.14159E0;
     declare variable $bookName := 'War and Peace';
 </pre>
 
 A query can access variable values via the standard 
 <code>$varName</code> syntax, as in <code>return ($x, $math:pi)</code> or 
 <code>/books/book[@name = $bookName]/author[@name = $authorName]</code>.
 <p>
 A query can declare <i>external global</i> variables, for example: 
 <pre>
     declare variable $foo     as xs:string external; 
     declare variable $size    as xs:integer external; 
     declare variable $myuri   as xs:anyURI external;
     declare variable $mydoc   as document-node() external;
     declare variable $myelem  as element() external;
     declare variable $mynodes as node()* external;
 </pre>
 
 External global variables can be bound and passed to the query as follows:
 <pre>
     Map vars = new HashMap();
     vars.put("foo", "hello world");
     vars.put("size", new Integer(99));
     vars.put("myuri", "http://www.w3.org/2001/XMLSchema");
     vars.put("mydoc", new Document(new Element("xyz")));
     vars.put("myelem", new Element("abc"));
     vars.put("mynodes", new Node[] {new Document(new Element("elem1")), new Element("elem2"))});
     vars.put("mydocs", new Node[] {
         new Builder().build(new File("samples/data/articles.xml")), 
         new Builder().build(new File("samples/data/p2pio.xml")) });
     
     String query = "for $d in $mydocs return $size * count($d)";
     Nodes results = new XQuery(query, null).execute(doc, null, vars).toNodes();
     new ResultSequenceSerializer().write(results, System.out);
 </pre>
 
 
 <h4>Standard functions, user defined functions and extension functions</h4>
 
 The <a target="_blank" href="http://www.saxonica.com/documentation/functions/intro.html">Standard XQuery functions</a> can be used directly.
 Also note that XPath 2.0 supports regular expressions via the standard
 <code>fn:matches</code>, <code>fn:replace</code>, and <code>fn:tokenize</code> 
 functions. For example:
 <pre>
 string-length('hello world');
 </pre>
  
 <p>
 A query can employ <i>user defined functions</i>, for example: 
 <pre>
     declare namespace ipo = "http://www.example.com/IPO";
     
     declare function local:total-price( $i as element(item)* ) as xs:double {
         let $subtotals := for $s in $i return $s/quantity * $s/USPrice
         return sum($subtotals)
     }; 
     
     for $p in doc("ipo.xml")/ipo:purchaseOrder
     where $p/shipTo/name="Helen Zoe" and $p/@orderDate = xs:date("1999-12-01")
     return local:total-price($p//item) 
 </pre>
 
 <i>Custom extension functions</i> written in Java can be defined and used as explained in the
 <a target="_blank" href="http://www.saxonica.com/documentation/extensibility/functions.html">Saxon Extensibility Functions</a> documentation.
 For example, here is query that outputs the square root of a number via a method in java.lang.Math,
 as well as calls static methods and constructors of java.lang.String, java.util.Date
 as well as other extension functions.
 <pre>
     declare namespace exslt-math = "http://exslt.org/math";
     declare namespace math   = "java:java.lang.Math";
     declare namespace date   = "java:java.util.Date"; 
     declare namespace string = "java:java.lang.String"; 
     declare namespace saxon  = "http://saxon.sf.net/";
 
     declare variable $query := string(doc("query.xml")/queries/query[1]);
 
     (
     exslt-math:sin(3.14)
     math:sqrt(16),
     math:pow(2,16),
     string:toUpperCase("hello"),
     date:new(),                    (: print current date :)
     date:getTime(date:new())       (: print current date in milliseconds :)
 
     saxon:eval(saxon:expression($query))  (: run a dynamically constructed query :)
     )
 </pre>


 <h4>Modules</h4>
 
 An XQuery module is a file containing a set of variable and function declarations. 
 For decomposition and reuse of functionality a module can import declarations from 
 other modules. Here are two example modules generating the factorial of a number:
 
 <pre>
     (: file modules/factorial.xq :)
     module namespace factorial = "http://example.com/factorial";
     declare function factorial:fact($i as xs:integer) as xs:integer {
         if ($i <= 1)
             then 1
             else $i * factorial:fact($i - 1)
     };

     (: file main.xq :)
     import module namespace factorial = "http://example.com/factorial" at "modules/factorial.xq";
     factorial:fact(4)
 
     [hoschek /Users/hoschek/unix/devel/nux] fire-xquery main.xq
     &lt;atomic-value xsi:type="xs:integer" xmlns="http://dsd.lbl.gov/nux" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">24&lt;/atomic-value>
 </pre>
 
 
 <h4>Customizing the doc() function</h4>
 
 A custom document URI resolver for the XQuery/XPath <code>doc()</code> function can be defined 
 in the constructor of this class.
 Other miscellaneous options can be made available to the query by calling configuration methods
 on a <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/DynamicQueryContext.html" title="class or interface in net.sf.saxon.query"><CODE>DynamicQueryContext</CODE></A> (per execution),
 or on the configuration object of a <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/StaticQueryContext.html" title="class or interface in net.sf.saxon.query"><CODE>StaticQueryContext</CODE></A> (per query).
 
 
 <h4>Performance</h4>
 
 For simple XPath expressions you can get a throughput of up to
 1000-20000 (100000) executions/sec over 200 (0.5) KB input documents, 
 served from memory (commodity PC 2004, JDK 1.5, server VM).
 Be aware that this is an example ballpark figure at best, because use cases, 
 documents and the complexity of queries vary wildly in practise.
 In any case, it is safe to assume that this XQuery/XPath implementation is 
 one of the fastest available. For details, see <A HREF="../../../nux/xom/sandbox/XQueryBenchmark.html" title="class in nux.xom.sandbox"><CODE>XQueryBenchmark</CODE></A>.
<P>

<P>
<DL>
<DT><B>Author:</B></DT>
  <DD>whoschek.AT.lbl.DOT.gov, $Author: hoschek3 $</DD>
</DL>
<HR>

<P>

<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#XQuery(java.lang.String, java.net.URI)">XQuery</A></B>(<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A>&nbsp;query,
       <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/net/URI.html" title="class or interface in java.net">URI</A>&nbsp;baseURI)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructs a new compiled XQuery from the given query.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#XQuery(java.lang.String, java.net.URI, net.sf.saxon.query.StaticQueryContext, nux.xom.pool.DocumentURIResolver)">XQuery</A></B>(<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A>&nbsp;query,
       <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/net/URI.html" title="class or interface in java.net">URI</A>&nbsp;baseURI,
       <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/StaticQueryContext.html" title="class or interface in net.sf.saxon.query">StaticQueryContext</A>&nbsp;staticContext,
       <A HREF="../../../nux/xom/pool/DocumentURIResolver.html" title="interface in nux.xom.pool">DocumentURIResolver</A>&nbsp;resolver)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructs a new compiled XQuery from the given query, base URI, static
 context and resolver.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#execute(nu.xom.Node)">execute</A></B>(<A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom">Node</A>&nbsp;contextNode)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executes (evaluates) the query against the given node.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#execute(nu.xom.Node, net.sf.saxon.query.DynamicQueryContext, java.util.Map)">execute</A></B>(<A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom">Node</A>&nbsp;contextNode,
        <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/DynamicQueryContext.html" title="class or interface in net.sf.saxon.query">DynamicQueryContext</A>&nbsp;dynamicContext,
        <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/util/Map.html" title="class or interface in java.util">Map</A>&nbsp;variables)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executes (evaluates) the query against the given node, using
 the given dynamic context and external variables.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#explain()">explain</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Returns a description of the compiled and optimized expression tree;
 useful for advanced performance diagnostics only.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../nux/xom/xquery/XQuery.html#newResultSequence(net.sf.saxon.query.XQueryExpression, net.sf.saxon.query.DynamicQueryContext)">newResultSequence</A></B>(<A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/XQueryExpression.html" title="class or interface in net.sf.saxon.query">XQueryExpression</A>&nbsp;expression,
                  <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/DynamicQueryContext.html" title="class or interface in net.sf.saxon.query">DynamicQueryContext</A>&nbsp;dynamicContext)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback that returns a result sequence for the current query execution.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html" title="class or interface in java.lang">Object</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#toString()" title="class or interface in java.lang">toString</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="XQuery(java.lang.String, java.net.URI)"><!-- --></A><H3>
XQuery</H3>
<PRE>
public <B>XQuery</B>(<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A>&nbsp;query,
              <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/net/URI.html" title="class or interface in java.net">URI</A>&nbsp;baseURI)
       throws <A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></PRE>
<DL>
<DD>Constructs a new compiled XQuery from the given query.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>query</CODE> - the query to compile<DD><CODE>baseURI</CODE> - an absolute URI, used when necessary in the resolution of
            relative URIs found in the query. Used by the XQuery
            <code>doc</code> function. (May be <code>null</code> in
            which case it defaults to the current working directory).
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></CODE> - if the query has a syntax error, or if it references
             namespaces, variables, or functions that have not been
             declared, or contains other static errors such as type mismatches.</DL>
</DL>
<HR>

<A NAME="XQuery(java.lang.String, java.net.URI, net.sf.saxon.query.StaticQueryContext, nux.xom.pool.DocumentURIResolver)"><!-- --></A><H3>
XQuery</H3>
<PRE>
public <B>XQuery</B>(<A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A>&nbsp;query,
              <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/net/URI.html" title="class or interface in java.net">URI</A>&nbsp;baseURI,
              <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/StaticQueryContext.html" title="class or interface in net.sf.saxon.query">StaticQueryContext</A>&nbsp;staticContext,
              <A HREF="../../../nux/xom/pool/DocumentURIResolver.html" title="interface in nux.xom.pool">DocumentURIResolver</A>&nbsp;resolver)
       throws <A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></PRE>
<DL>
<DD>Constructs a new compiled XQuery from the given query, base URI, static
 context and resolver.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>query</CODE> - the query to compile<DD><CODE>baseURI</CODE> - an absolute URI, used when necessary in the resolution of
            relative URIs found in the query. Used by the XQuery
            <code>doc</code> function, and hence the resolver. May be
            <code>null</code> in which case it defaults to the current
            working directory.<DD><CODE>staticContext</CODE> - the context and configuration to use; per query (may be
            <code>null</code>).<DD><CODE>resolver</CODE> - an object that is called by the XQuery processor to turn a URI
            passed to the XQuery <code>doc()</code> function into a XOM
            <A HREF="http://www.xom.nu/apidocs/nu/xom/Document.html" title="class or interface in nu.xom"><CODE>Document</CODE></A>. May be <code>null</code> in which case
            non-validating non-pooled default resolution is used.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></CODE> - if the query has a syntax error, or if it references
             namespaces, variables, or functions that have not been
             declared, or contains other static errors such as type
             mismatches.</DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="execute(nu.xom.Node)"><!-- --></A><H3>
execute</H3>
<PRE>
public <A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A> <B>execute</B>(<A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom">Node</A>&nbsp;contextNode)
                       throws <A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></PRE>
<DL>
<DD>Executes (evaluates) the query against the given node.
 Results are returned in 
 <a target="_blank" href="http://www.w3.org/TR/xpath#dt-document-order">document order</a>, 
 unless specified otherwise by the query.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>contextNode</CODE> - the context node to execute the query against. The context
            node is available to the query as the value of the query
            expression ".". If this parameter is <code>null</code>, the
            context node will be undefined.
<DT><B>Returns:</B><DD>a result sequence iterator producing zero or more results
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></CODE> - if an error occurs during execution, for example division
             overflow, or a type error caused by type mismatch, or an
             error raised by the XQuery function fn:error().</DL>
</DD>
</DL>
<HR>

<A NAME="execute(nu.xom.Node, net.sf.saxon.query.DynamicQueryContext, java.util.Map)"><!-- --></A><H3>
execute</H3>
<PRE>
public <A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A> <B>execute</B>(<A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom">Node</A>&nbsp;contextNode,
                              <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/DynamicQueryContext.html" title="class or interface in net.sf.saxon.query">DynamicQueryContext</A>&nbsp;dynamicContext,
                              <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/util/Map.html" title="class or interface in java.util">Map</A>&nbsp;variables)
                       throws <A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></PRE>
<DL>
<DD>Executes (evaluates) the query against the given node, using
 the given dynamic context and external variables.
 Results are returned in 
 <a target="_blank" href="http://www.w3.org/TR/xpath#dt-document-order">document order</a>, 
 unless specified otherwise by the query.
 <p>
 Argument <code>variables</code> specifies external global variables in
 the form of zero or more <code>variableName --> variableValue</code>
 map associations. Each map entry's key and value are interpreted as
 follows:
 <ul>
 <li>variableName (key): The name of the variable in "{uri}local-name"
 format. It is not an error to supply a value for a variable that has not
 been declared in the query, the variable will simply be ignored. If the
 variable has been declared in the query (as an external global variable)
 then it will be initialized with the value supplied.</li>
 
 <li>variableValue (value): The value of the variable. This can be any
 valid Java object. In particular it can be a <A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom"><CODE>Node</CODE></A> object or
 a <A HREF="http://www.xom.nu/apidocs/nu/xom/Node.html" title="class or interface in nu.xom"><CODE>Node</CODE></A>[] array or a <A HREF="http://www.xom.nu/apidocs/nu/xom/Nodes.html" title="class or interface in nu.xom"><CODE>Nodes</CODE></A> object. It follows the same conversion rules as a
 value returned from a Saxon extension function. An error will occur at
 query execution time if the supplied value cannot be converted to the
 required type as declared in the query. For precise control of the type
 of the value, instantiate one of the classes in the
 <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/value/package-summary.html"><CODE>net.sf.saxon.value</CODE></A> package, for example
 <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/value/DateTimeValue.html" title="class or interface in net.sf.saxon.value"><CODE>DateTimeValue</CODE></A>.</li>
 </ul>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>contextNode</CODE> - the context node to execute the query against. The context
            node is available to the query as the value of the query
            expression ".". If this parameter is <code>null</code>, the
            context node will be undefined.<DD><CODE>dynamicContext</CODE> - optional dynamic context of this execution (may be
            <code>null</code>). If not <code>null</code>, the
            Configuration object of the dynamic context must be the
            same as the Configuration object that was used when creating
            the StaticQueryContext.<DD><CODE>variables</CODE> - optional external global variables to be bound on the dynamic
            context; per execution (may be <code>null</code>).
<DT><B>Returns:</B><DD>a result sequence iterator producing zero or more results
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></CODE> - if an error occurs during execution, for example division
             overflow, or a type error caused by type mismatch, or an
             error raised by the XQuery function fn:error().</DL>
</DD>
</DL>
<HR>

<A NAME="explain()"><!-- --></A><H3>
explain</H3>
<PRE>
public <A HREF="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html" title="class or interface in java.lang">String</A> <B>explain</B>()</PRE>
<DL>
<DD>Returns a description of the compiled and optimized expression tree;
 useful for advanced performance diagnostics only.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>a string description</DL>
</DD>
</DL>
<HR>

<A NAME="newResultSequence(net.sf.saxon.query.XQueryExpression, net.sf.saxon.query.DynamicQueryContext)"><!-- --></A><H3>
newResultSequence</H3>
<PRE>
protected <A HREF="../../../nux/xom/xquery/ResultSequence.html" title="interface in nux.xom.xquery">ResultSequence</A> <B>newResultSequence</B>(<A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/XQueryExpression.html" title="class or interface in net.sf.saxon.query">XQueryExpression</A>&nbsp;expression,
                                           <A HREF="http://dsd.lbl.gov/%7Ehoschek/javatree/share/xml/saxonb-8.7.3/doc/javadoc/net/sf/saxon/query/DynamicQueryContext.html" title="class or interface in net.sf.saxon.query">DynamicQueryContext</A>&nbsp;dynamicContext)
                                    throws <A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></PRE>
<DL>
<DD>Callback that returns a result sequence for the current query execution.
 <p>
 An XQuery result sequence may, apart from "normal" nodes, also contain
 <b>top-level</b> values of <a target="_blank"
 href="http://www.w3.org/TR/xpath-functions/#datatypes">atomic types </a>
 such as xs:string, xs:integer, xs:double, xs:boolean, etc, all of which are not XML nodes.
 Hence, a way to convert atomic values to normal XML nodes is needed.
 <p>
 This method's result sequence implementation converts each <b>top-level</b>
 atomic value to an <A HREF="http://www.xom.nu/apidocs/nu/xom/Element.html" title="class or interface in nu.xom"><CODE>Element</CODE></A> named "atomic-value" with a child
 <A HREF="http://www.xom.nu/apidocs/nu/xom/Text.html" title="class or interface in nu.xom"><CODE>Text</CODE></A> node holding the atomic value's standard XPath 2.0 string representation. 
 An "atomic-value" element is decorated with a namespace and a W3C XML Schema type attribute.
 "Normal" nodes and anything not at top-level is returned "as is", without conversion.
 <p>
 Overrride this default implementation if you need custom conversions in
 result sequence implementations. Note however, that conversions of atomic
 values should rarely be used. It is often more desirable to avoid such
 atomic conversions altogether. This can almost always easily be achieved
 by formulating the <b>xquery string</b> such that it wraps atomic values via
 standard XQuery constructors (rather than via Java methods) into an element
 or attribute or text or document. That way, the query always produces a "normal"
 XML node sequence as output, and never produces a sequence of atomic
 values as output, and thus custom conversion by this class are never
 needed and invoked.
 <p>
 For example, by default the following query 
 <pre>
     for $i in (1, 2, 3) return $i
 </pre>
 yields this (perhaps somewhat unexpected) output:
 <pre>
     &lt;item:atomic-value xsi:type="xs:integer" xmlns:item="http://dsd.lbl.gov/nux" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">1&lt;/atomic-value>
     &lt;item:atomic-value xsi:type="xs:integer" xmlns:item="http://dsd.lbl.gov/nux" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">2&lt;/atomic-value>
     &lt;item:atomic-value xsi:type="xs:integer" xmlns:item="http://dsd.lbl.gov/nux" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">3&lt;/atomic-value>
 </pre>
 <p>
 This format is good for software processing, but not very human readable.
 Hence, most likely you will want to rewrite the query along the following lines: 
 <pre>
     for $i in (1, 2, 3) return &lt;item> {$i} &lt;/item>
 </pre>
 now yielding as output three <A HREF="http://www.xom.nu/apidocs/nu/xom/Element.html" title="class or interface in nu.xom"><CODE>Element</CODE></A> nodes:
 <pre>
     &lt;item>1&lt;/item> 
     &lt;item>2&lt;/item>
     &lt;item>3&lt;/item>
 </pre>
 Or you might want to rewrite the query along the following lines: 
 <pre>
     for $i in (1, 2, 3) return text {$i}
 </pre>
 now yielding as output three <A HREF="http://www.xom.nu/apidocs/nu/xom/Text.html" title="class or interface in nu.xom"><CODE>Text</CODE></A> nodes:
 <pre>
     1 
     2
     3
 </pre>
 Observe that the rewritten query converts top-level atomic values 
 precisely as desired by the user, without needing any Java-level conversion.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>expression</CODE> - the compiled query expression<DD><CODE>dynamicContext</CODE> - the dynamic context of this execution
<DT><B>Returns:</B><DD>a result sequence implementation
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery">XQueryException</A></CODE> - if an error occurs during execution</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/XQuery.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
<b>Nux 1.6</b></EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../nux/xom/xquery/StreamingTransform.html" title="interface in nux.xom.xquery"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../nux/xom/xquery/XQueryException.html" title="class in nux.xom.xquery"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?nux/xom/xquery/XQuery.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="XQuery.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
